---
description: 
globs: 
alwaysApply: false
---
# PLAN MODE: LLM-Powered Planning Workflow

## OVERVIEW
This mode uses the AI's Large Language Model (LLM) capabilities to analyze the project goal and context, then propose a high-level plan structured into Epics, Sprints, and Tasks. The output of this mode is the generated plan text, intended for review and subsequent manual refinement or use in updating `tasks.md`.

## WORKFLOW

```mermaid
graph TD
    Start["PLAN Mode Start"] --> AutoSync["Step 1: Auto-Sync Completed Tasks (Optional)"]
    AutoSync --> ReadContext["Step 2: Read Project Context"]
    ReadContext --> IdentifyGoal["Step 3: Identify Planning Goal"]
    IdentifyGoal --> GeneratePlan["Step 4: Generate Epic/Sprint/Task Plan (LLM Task)"]
    GeneratePlan --> OutputPlan["Step 5: Output Generated Plan Text"]
    OutputPlan --> End["PLAN Mode End - Review Plan"]
```

## DETAILED STEPS

### Step 1: Auto-Sync Completed Tasks (Optional Check)
*   **(Optional) Action**: Perform the automatic check for tasks completed in Jira but not updated in `tasks.md`, proposing `edit_file` if needed. (Keep this step for data hygiene).

### Step 2: Read Project Context
*   **Action**: Read relevant context files to understand the project goals and current state. Primarily focus on:
    *   `projectbrief.md` (If available)
    *   `activeContext.md` (If available and relevant)
    *   `tasks.md` (To understand existing tasks and structure)
    *   User's initial request for planning.

### Step 3: Identify Planning Goal
*   **Action**: Based on the context read in Step 2, clearly state the main goal or feature that needs to be planned. Ask the user for clarification if the goal is unclear.
*   **Report**: "Цель планирования: [Сформулированная цель]."

### Step 4: Generate Epic/Sprint/Task Plan (LLM Task)
*   **Instruction (Prompt for LLM)**: "Проанализируй сформулированную цель (из Шага 3) и прочитанный контекст проекта. Используя свое понимание разработки ПО и управления проектами:
    1.  Определи 2-5 крупных логических блоков работы (**Эпиков**), необходимых для достижения цели. Дай каждому Эпику понятное название.
    2.  Для **каждого Эпика** предложи список **конкретных, выполнимых задач**, необходимых для его реализации. Формулируй задачи четко.
    3.  Сгруппируй предложенные задачи в последовательные **Спринты** (например, по 3-7 задач в каждом, или по предполагаемой сложности на 1-2 недели работы). Назови Спринты (например, 'Спринт 1', 'Спринт 2' или по датам).
    4.  Отформатируй весь план, используя Markdown: Заголовки 2-го уровня (`##`) для Эпиков, Заголовки 3-го уровня (`###`) для Спринтов, и списки (`- [ ]`) для задач."
*   **(Internal LLM Execution)**: The AI model will process this prompt and generate the plan structure based on its understanding.

### Step 5: Output Generated Plan Text
*   **Action**: Output the complete plan text generated by the LLM in the previous step directly into the chat for user review.
*   **Report**: "Вот предложенный план, разбитый по Эпикам и Спринтам. Пожалуйста, просмотрите его. Вы можете использовать этот план для обновления `tasks.md` или дальнейшего обсуждения."

### Step 6: PLAN Mode End - Review Plan
*   The mode concludes after presenting the plan. Further actions (like editing `tasks.md` based on this plan, creating Jira tickets, or moving to another mode) should be initiated by the user in subsequent requests.
